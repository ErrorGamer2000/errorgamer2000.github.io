class i{constructor(t,e){this.context=new t;this.t=e;this.i=false}o(){if(!this.i)throw new Error("Analyzer needs initiation. To initiate call <analyzer>.init().then(<analyzer>.analyze).");c.l("Analyzing");this.filter();this.normalize();this.u=this.h.join("\n");c.l(this.u)}filter(){if(!this.i)return false;let i=this.m.getChannelData(0);let o=m.f(1/(30/this.m.sampleRate));let e=m.f(1/o*i.length);let a=[];for(let t=0;t<e;t++){let e=o*t;let n=0;for(let t=0;t<o;t++){n+=m.a(i[e+t])}a.push(n/o)}this.p=a}normalize(){let e=m.v(m.g(...this.p),-1);this.h=this.p.map(t=>t*e)}}Object.defineProperty(i.prototype,"init",{value:async function(){this.m=await this.context.decodeAudioData(this.t);delete this.t;this.i=true},A:false});class i{constructor(t,e){this.context=new t;this.t=e;this.i=false}o(){if(!this.i)throw new Error("Analyzer needs initiation. To initiate call <analyzer>.init().then(<analyzer>.analyze).");c.l("Analyzing");this.filter();this.normalize();this.u=this.h.join("\n");c.l(this.u)}filter(){if(!this.i)return false;let i=this.m.getChannelData(0);let o=m.f(1/(30/this.m.sampleRate));let e=m.f(1/o*i.length);let a=[];for(let t=0;t<e;t++){let e=o*t;let n=0;for(let t=0;t<o;t++){n+=m.a(i[e+t])}a.push(n/o)}this.p=a}normalize(){let e=m.v(m.g(...this.p),-1);this.h=this.p.map(t=>t*e)}}Object.defineProperty(i.prototype,"init",{value:async function(){this.m=await this.context.decodeAudioData(this.t);delete this.t;this.i=true},A:false});const o=t=>typeof t==="boolean"?t:typeof t==="string"?t.toLowerCase()==="true"?true:t.toLowerCase()==="false"?false:Boolean(t):typeof t==="object"?Array.isArray(t)?t.length>0:Object.keys(t).length>0:Boolean(t);let a;let e=0;let l=document.querySelector("canvas");let n=l.getContext("2d");let s=0;let r=false;let u=[];let d;const h=document.querySelector("audio");let f;p(l,n,2);n.fillStyle="#ff9800";document.querySelector("#uploadbtn").onclick=()=>document.querySelector('input[type="file"]').click();window.addEventListener("dragenter",t=>{t.preventDefault();document.querySelector("#upload").classList.add("dropHover");e++});document.addEventListener("dragover",t=>{t.preventDefault()});document.querySelector("#upload").addEventListener("drop",t,true);window.addEventListener("dragleave",t=>{if(--e===0){t.preventDefault();document.querySelector("#upload").classList.remove("dropHover")}});function t(t){t.preventDefault();document.querySelector("#upload").classList.remove("dropHover");if(t.dataTransfer.items){w({data:t.dataTransfer.items[0].getAsFile()})}else{w({data:t.dataTransfer.files[0]})}}const y=document.querySelector("input");y.addEventListener("change",w);async function w({data:t}){if(t){a=[t]}else{if(!o(this.files)){if(a)this.files=a;return}a=this.files}h.pause();document.querySelector("#overlay").dataset.hidden="false";(document.body||document.documentElement).classList.add("overlayed");h.dataset.hidden="true";h.src=URL.createObjectURL(a[0]);h.load();const e=await a[0].arrayBuffer();d=new i(AudioContext,e);await d.init();d.o();f=new Download(a[0].name.replace(/(.*)\..*/g,"$1[Scratch Audio Analyzer].txt"),d.u);document.querySelector("#overlay").dataset.hidden="true";(document.body||document.documentElement).classList.remove("overlayed");h.dataset.hidden="false";let n=document.createElement("a");n.href="#step2";(document.body||document.documentElement).append(n);n.click();(document.body||document.documentElement).removeChild(n);await h.play();u=[];for(let t=0;t<m.f(l.clientWidth/35)+1;t++){u.push([35*t+2.5,15])}r=true;z()&&z();document.querySelector("#downloadbtn").onclick=()=>f.init();h.addEventListener("ended",()=>{s=0;let t=document.createElement("a");t.href="#step3";(document.body||document.documentElement).append(t);t.click();(document.body||document.documentElement).removeChild(t)})}function p(t,e,n){if(!(t instanceof Element))return false;let{width:i,height:o}=t.getBoundingClientRect();t.style.height=`${o}px`;t.style.width=`${i}px`;t.height=o*n;t.width=i*n;e=t.getContext("2d");e.scale(n,n)}function z(){if(r){r=false;s=0;return true}requestAnimationFrame(z);if(h.paused)return;s+=.5;let t=m.f(s);let e=m.f(h.currentTime/h.duration*d.h.length);if(t!==s)return;n.clearRect(0,0,l.clientWidth,l.clientHeight);u.forEach(t=>{t[1]+=(l.clientHeight*.5*(d.h[e]||0)+v(50,100+50*d.h[e])-t[1])/6;n.fillRect(t[0],0,30,t[1])})}function v(t,e,n=0){let i=1;for(let t=0;t<n;t++){i*=10}return m.j(i*(m.r()*(e-t)+t))/i}
